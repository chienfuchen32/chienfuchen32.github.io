<!doctype html><html lang=en-us><head><meta charset=utf-8><meta content="Jeff’s note" name=apple-mobile-web-app-title><meta content="Ingress,Kubernetes" name=keywords><meta content="#0d6efd" name=theme-color><meta content="width=device-width,initial-scale=1" name=viewport><meta property="og:url" content="https://chienfuchen32.github.io/posts/k8s-guide-for-developer/"><meta property="og:site_name" content="Jeff's note"><meta property="og:title" content="Kubernetes Guide for Developer"><meta property="og:description" content="Environment Before you try to use any client tool connect to Kubernetes, please check the endpoint field “server” of “cluster” credential config file.
Please make sure you’re able connect with the kube-apiserver.
For instance, example below shown here is “k8s-cluster”
apiVersion: v1 kind: Config clusters: - name: team-a-admin@kubernetes cluster: server: 'https://k8s-cluster:8443' certificate-authority-data: >- xxxxx users: - name: team-a-admin user: token: >- xxxxx contexts: - name: team-a-admin@kubernetes context: user: team-a-admin cluster: team-a-admin@kubernetes namespace: team-a current-context: team-a-admin@kubernetes This example is based on self-host Kubernetes v1.18 environment, you machine might not be able to recognize the target,"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-18T14:32:45+08:00"><meta property="article:modified_time" content="2022-03-18T14:32:45+08:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Ingress"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kubernetes Guide for Developer"><meta name=twitter:description content="Environment Before you try to use any client tool connect to Kubernetes, please check the endpoint field “server” of “cluster” credential config file.
Please make sure you’re able connect with the kube-apiserver.
For instance, example below shown here is “k8s-cluster”
apiVersion: v1 kind: Config clusters: - name: team-a-admin@kubernetes cluster: server: 'https://k8s-cluster:8443' certificate-authority-data: >- xxxxx users: - name: team-a-admin user: token: >- xxxxx contexts: - name: team-a-admin@kubernetes context: user: team-a-admin cluster: team-a-admin@kubernetes namespace: team-a current-context: team-a-admin@kubernetes This example is based on self-host Kubernetes v1.18 environment, you machine might not be able to recognize the target,"><title>Kubernetes Guide for Developer · Posts · Jeff’s note</title><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon-96x96.png rel=icon sizes=96x96 type=image/png><link href=/favicon.ico rel="shortcut icon"><link href=/favicon.svg rel=icon type=image/svg+xml><link href=/web-app-manifest-192x192.png rel=icon type=image/png><link href=/web-app-manifest-512x512.png rel=icon type=image/png><link href=/site.webmanifest rel=manifest><link crossorigin=anonymous href=/css/paige/paige.8ea46cfa47cc7e78236914d538408cfac2c73774.min.3b5b583ef4a5c7e93743e15582585c9c2a7621b8fef6c9c7ad4bac50e4781f05.css integrity="sha256-O1tYPvSlx+k3Q+FVglhcnCp2Ibj+9snHrUusUOR4HwU=" referrerpolicy=no-referrer rel=stylesheet><link crossorigin=anonymous href=/css/paige/bootstrap/paige.37b3fc66686a7163af8180c5fb0fc6ab835321eb.min.55516fbe90a5aad46d6dbc2441c1c193504ee32cb1eef5070ab589c776231a4c.css integrity="sha256-VVFvvpClqtRtbbwkQcHBk1BO4yyx7vUHCrWJx3YjGkw=" referrerpolicy=no-referrer rel=stylesheet><link crossorigin=anonymous href=/css/paige/bootstrap-icons/bootstrap-icons.min.755bbaf60ab33d8f6213c74d33daea2ef5bf22d15245142a27529f8c1d7e80f1.css integrity="sha256-dVu69gqzPY9iE8dNM9rqLvW/ItFSRRQqJ1KfjB1+gPE=" referrerpolicy=no-referrer rel=stylesheet></head><body><div class=container><div class=row><div class="col mt-3" id=paige-site><header id=paige-site-header><div class="display-1 fw-bold text-center" id=paige-site-title><a class="text-body text-decoration-none" href=/>Jeff&rsquo;s note</a></div><nav aria-label=Menu class=paige-row-tall id=paige-site-menu><ul class="align-items-center justify-content-center nav"><li class=nav-item><a class="nav-link text-decoration-underline" href=/about/>About</a></li><li class=nav-item><a aria-current=page class="active fw-bold text-body nav-link text-decoration-underline" href=/posts/>Posts</a></li><li class=nav-item><a class="nav-link text-decoration-underline" href=/tags/>Tags</a></li></ul></nav><nav aria-label=Breadcrumbs class=paige-row-tall id=paige-site-breadcrumbs><div class="d-flex justify-content-center"><ol class="breadcrumb mb-0"><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/posts/>Posts</a></li></ol></div></nav></header><article class="align-items-center d-flex flex-column paige-kind-page paige-status-draft paige-status-unpublished" id=paige-page><header class="mw-100 text-center" id=paige-page-header><h1 class=fw-bold id=paige-page-title>Kubernetes Guide for Developer</h1><div><p class="paige-row-short text-secondary" id=paige-page-keywords><a class="link-secondary paige-page-keyword-tag" href=/tags/ingress/>Ingress</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/kubernetes/>Kubernetes</a></p><p class="paige-row-short text-secondary" id=paige-page-date><time datetime=2022-03-18>March 18, 2022</time></p><p class="paige-row-short text-secondary" id=paige-page-word-count>497 words</p><p class="paige-row-short text-secondary" id=paige-page-reading-time>3 minutes</p></div><div class="align-items-center d-flex flex-column paige-row-tall text-start" id=paige-page-toc><div class="border rounded" style="padding:1rem 2rem 0 1rem"><nav id=TableOfContents><ul><li><a href=#environment>Environment</a><ul><li></li></ul></li><li><a href=#docker-registry>Docker Registry</a></li><li><a href=#deployment-example-in-our-environment>Deployment example in our environment</a></li><li><a href=#service-ingress>Service, Ingress</a></li><li><a href=#pvc>PVC</a></li></ul></nav></div></div></header><main class=mw-100 id=paige-page-content><h2 class=h4 id=environment><a href=#environment style=color:rgba(var(--bs-body-color-rgb),var(--bs-text-opacity));text-decoration:none>Environment</a></h2><p>Before you try to use any client tool connect to Kubernetes, please check the endpoint field
&ldquo;server&rdquo; of &ldquo;cluster&rdquo; credential config file.</p><p>Please make sure you&rsquo;re able connect with the kube-apiserver.</p><p>For instance, example below shown here is &ldquo;k8s-cluster&rdquo;</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Config
</span></span><span style=display:flex><span>clusters:
</span></span><span style=display:flex><span>  - name: team-a-admin@kubernetes
</span></span><span style=display:flex><span>    cluster:
</span></span><span style=display:flex><span>      server: <span style=color:#a31515>&#39;https://k8s-cluster:8443&#39;</span>
</span></span><span style=display:flex><span>      certificate-authority-data: &gt;-<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>        xxxxx</span>
</span></span><span style=display:flex><span>users:
</span></span><span style=display:flex><span>  - name: team-a-admin
</span></span><span style=display:flex><span>    user:
</span></span><span style=display:flex><span>      token: &gt;-<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>        xxxxx</span>
</span></span><span style=display:flex><span>contexts:
</span></span><span style=display:flex><span>  - name: team-a-admin@kubernetes
</span></span><span style=display:flex><span>    context:
</span></span><span style=display:flex><span>      user: team-a-admin
</span></span><span style=display:flex><span>      cluster: team-a-admin@kubernetes
</span></span><span style=display:flex><span>      namespace: team-a
</span></span><span style=display:flex><span>current-context: team-a-admin@kubernetes
</span></span></code></pre></div><p>This example is based on self-host Kubernetes v1.18 environment, you machine might not be able to recognize the
target,</p><p>it lack of DNS and k8s apiserver certificate support currently.</p><p>If you have trouble with this kind of problem, please add a record in my <b>hosts</b> file,
that makes my machine&rsquo;s dns resolvable.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span># File path
</span></span><span style=display:flex><span># Windows: `C:\Windows\System32\drivers\etc\hosts`
</span></span><span style=display:flex><span># Linux: `/etc/hosts`
</span></span><span style=display:flex><span>192.168.24.1 k8s-cluster`
</span></span></code></pre></div><h4 class=h6 id=k8s-client><a href=#k8s-client style=color:rgba(var(--bs-body-color-rgb),var(--bs-text-opacity));text-decoration:none>K8S client</a></h4><ul><li><a href=https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/ rel=external>https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/</a></li><li><a href=https://k8slens.dev/ rel=external>https://k8slens.dev/</a></li><li><a href=https://k9scli.io rel=external>https://k9scli.io</a></li><li><a href=https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/ rel=external>https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/</a></li></ul><h2 class=h4 id=docker-registry><a href=#docker-registry style=color:rgba(var(--bs-body-color-rgb),var(--bs-text-opacity));text-decoration:none>Docker Registry</a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker login my-registry.com
</span></span><span style=display:flex><span>Username: 
</span></span><span style=display:flex><span>Password:
</span></span><span style=display:flex><span>$ docker push my-registry.com/my-app:0.0.1
</span></span></code></pre></div><h2 class=h4 id=deployment-example-in-our-environment><a href=#deployment-example-in-our-environment style=color:rgba(var(--bs-body-color-rgb),var(--bs-text-opacity));text-decoration:none>Deployment example in our environment</a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: apps/v1
</span></span><span style=display:flex><span>kind: Deployment
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-app
</span></span><span style=display:flex><span>  namespace: team-a
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  selector:
</span></span><span style=display:flex><span>    matchLabels:
</span></span><span style=display:flex><span>      app: my-app
</span></span><span style=display:flex><span>  replicas: 1 <span style=color:green># tells deployment to run 2 pods matching the template</span>
</span></span><span style=display:flex><span>  template:
</span></span><span style=display:flex><span>    metadata:
</span></span><span style=display:flex><span>      labels:
</span></span><span style=display:flex><span>        app: my-app
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      containers:
</span></span><span style=display:flex><span>      - name: my-app
</span></span><span style=display:flex><span>        image: my-registry/my-app:0.0.1
</span></span><span style=display:flex><span>        ports:
</span></span><span style=display:flex><span>        - containerPort: 80
</span></span><span style=display:flex><span>      nodeSelector:
</span></span><span style=display:flex><span>        node-role.kubernetes.io/worker: <span style=color:#a31515>&#39;true&#39;</span> <span style=color:green># We have many VMs in the Kubernetes cluster. </span>
</span></span><span style=display:flex><span>We prefer all the pod running on certain VM, please add description below in my deployment. 
</span></span><span style=display:flex><span>That will make pods running on our pre labeled K8S worker node.
</span></span><span style=display:flex><span>      imagePullSecrets:
</span></span><span style=display:flex><span>        - name: my-registry-auth
</span></span></code></pre></div><ul><li><a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/ rel=external>https://kubernetes.io/docs/concepts/workloads/controllers/deployment/</a></li></ul><h2 class=h4 id=service-ingress><a href=#service-ingress style=color:rgba(var(--bs-body-color-rgb),var(--bs-text-opacity));text-decoration:none>Service, Ingress</a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Service
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-app-svc
</span></span><span style=display:flex><span>  namespace: team-a
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  ports:
</span></span><span style=display:flex><span>    - name: http
</span></span><span style=display:flex><span>      protocol: TCP
</span></span><span style=display:flex><span>      port: 80
</span></span><span style=display:flex><span>      targetPort: 80
</span></span><span style=display:flex><span>  selector:
</span></span><span style=display:flex><span>    app: my-app
</span></span><span style=display:flex><span>  type: ClusterIP
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: extensions/v1beta1
</span></span><span style=display:flex><span>kind: Ingress
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-app-ingress
</span></span><span style=display:flex><span>  namespace: team-a
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app: my-app
</span></span><span style=display:flex><span>    kubernetes.io/ingress.class: nginx
</span></span><span style=display:flex><span>    nginx.ingress.kubernetes.io/use-regex: <span style=color:#a31515>&#39;true&#39;</span>
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  rules:
</span></span><span style=display:flex><span>    - host: my-app.deltaww.com
</span></span><span style=display:flex><span>      http:
</span></span><span style=display:flex><span>        paths:
</span></span><span style=display:flex><span>          - path: /prefix(/|$)(.*)
</span></span><span style=display:flex><span>            backend:
</span></span><span style=display:flex><span>              serviceName: my-app-svc
</span></span><span style=display:flex><span>              servicePort: 80
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>apiVersion: extensions/v1beta1
</span></span><span style=display:flex><span>kind: Ingress
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-domain-ingress
</span></span><span style=display:flex><span>  namespace: team-a
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app: my-domain
</span></span><span style=display:flex><span>    kubernetes.io/ingress.class: nginx
</span></span><span style=display:flex><span>    nginx.ingress.kubernetes.io/use-regex: <span style=color:#a31515>&#39;true&#39;</span>
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  tls:
</span></span><span style=display:flex><span>    - hosts:
</span></span><span style=display:flex><span>        - my-domain.com
</span></span><span style=display:flex><span>      secretName: my-tls <span style=color:green># please make sure there&#39;s an existed K8S secret in </span>
</span></span><span style=display:flex><span>the same namespace
</span></span><span style=display:flex><span>  rules:
</span></span><span style=display:flex><span>    - host: my-domain.com
</span></span><span style=display:flex><span>      http:
</span></span><span style=display:flex><span>        paths:
</span></span><span style=display:flex><span>          - path: /prefix(/|$)(.*)
</span></span><span style=display:flex><span>            backend:
</span></span><span style=display:flex><span>              serviceName: my-app-svc
</span></span><span style=display:flex><span>              servicePort: 80
</span></span></code></pre></div><ul><li><a href=https://kubernetes.io/docs/concepts/services-networking/service/ rel=external>https://kubernetes.io/docs/concepts/services-networking/service/</a></li><li><a href=https://kubernetes.io/docs/concepts/services-networking/ingress/ rel=external>https://kubernetes.io/docs/concepts/services-networking/ingress/</a></li></ul><h2 class=h4 id=pvc><a href=#pvc style=color:rgba(var(--bs-body-color-rgb),var(--bs-text-opacity));text-decoration:none>PVC</a></h2><p>Here&rsquo;s a PVC resource example.</p><p>The storageClassName describe below, rook-ceph is installed in our self-host environment. If you application is running on other Kubernetes cluster, please contact administrator.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: PersistentVolumeClaim
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-app-logs-pvc
</span></span><span style=display:flex><span>  namespace: team-a
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    app: my-app-logs-pvc
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  accessModes:
</span></span><span style=display:flex><span>    - ReadWriteOnce
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>    requests:
</span></span><span style=display:flex><span>      storage: 10Gi
</span></span><span style=display:flex><span>  storageClassName: rook-ceph-block
</span></span><span style=display:flex><span>  volumeMode: Filesystem
</span></span></code></pre></div><p>Here&rsquo;s an example for logging file path mounting PVC</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Pod
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-app2
</span></span><span style=display:flex><span>  namespace: team-a
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  volumes:
</span></span><span style=display:flex><span>    - name: my-app-logs-storage
</span></span><span style=display:flex><span>      persistentVolumeClaim:
</span></span><span style=display:flex><span>        claimName: my-app-logs-pvc
</span></span><span style=display:flex><span>  containers:
</span></span><span style=display:flex><span>    - name: my-app2
</span></span><span style=display:flex><span>      image: my-registry.com/my-app:0.0.1
</span></span><span style=display:flex><span>      volumeMounts:
</span></span><span style=display:flex><span>        - mountPath: <span style=color:#a31515>&#34;/app/logs&#34;</span>
</span></span><span style=display:flex><span>          name: my-app-logs-storage
</span></span><span style=display:flex><span>  nodeSelector:
</span></span><span style=display:flex><span>    node-role.kubernetes.io/worker: <span style=color:#a31515>&#39;true&#39;</span> <span style=color:green># We have many VMs in the Kubernetes cluster. We </span>
</span></span><span style=display:flex><span>prefer all the pod running on certain VM, please add description below in my deployment. 
</span></span><span style=display:flex><span>That will make pods running on our pre labeled K8S worker node.
</span></span><span style=display:flex><span>  imagePullSecrets:
</span></span><span style=display:flex><span>    - name: my-registry-auth
</span></span></code></pre></div><ul><li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/ rel=external>https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/</a></li></ul></main><footer class=mw-100 id=paige-page-footer><div id=paige-page-siblings><div class="paige-row-short text-center text-secondary" id=paige-page-next><a class=link-secondary href=https://chienfuchen32.github.io/posts/luks-tang/>Disk encryption: LUKS ( Linux Unified Key Setup) with Tang</a> &#8250;</div><div class="paige-row-short text-center text-secondary" id=paige-page-prev>&#8249; <a class=link-secondary href=https://chienfuchen32.github.io/posts/nginx-ingress-controller-k8s-guide/>Nginx Ingress Controller K8S Guide</a></div></div></footer></article><footer id=paige-site-footer><p class="paige-row-short text-center text-secondary" id=paige-site-credit><a class="link-secondary text-decoration-none" href=https://github.com/willfaught/paige>Paige Theme</a></p></footer></div></div></div><script crossorigin=anonymous defer integrity="sha256-GdpV5fXTSprZ1he71RUKGZl0E3HtqxFXvbylEdkWmRQ=" referrerpolicy=no-referrer src=/js/paige/bootstrap/bootstrap.bundle.min.19da55e5f5d34a9ad9d617bbd5150a1999741371edab1157bdbca511d9169914.js></script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","abstract":" Environment Before you try to use any client tool connect to Kubernetes, please check the endpoint field “server” of “cluster” credential config file.\nPlease make sure you’re able connect with the kube-apiserver.\nFor instance, example below shown here is “k8s-cluster”\napiVersion: v1 kind: Config clusters: - name: team-a-admin@kubernetes cluster: server: 'https://k8s-cluster:8443' certificate-authority-data: \u003e- xxxxx users: - name: team-a-admin user: token: \u003e- xxxxx contexts: - name: team-a-admin@kubernetes context: user: team-a-admin cluster: team-a-admin@kubernetes namespace: team-a current-context: team-a-admin@kubernetes This example is based on self-host Kubernetes v1.18 environment, you machine might not be able to recognize the target,","articleSection":"Posts","dateCreated":"2022-03-18T14:32:45+08:00","dateModified":"2022-03-18T14:32:45+08:00","headline":"Kubernetes Guide for Developer","inLanguage":"en-us","keywords":"Ingress, Kubernetes","name":"Kubernetes Guide for Developer","timeRequired":"PT3M","url":"https://chienfuchen32.github.io/posts/k8s-guide-for-developer/","wordCount":497}</script><noscript>JavaScript is required</noscript></body></html>