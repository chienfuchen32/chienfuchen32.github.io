<!doctype html><html lang=en-us><head><meta charset=utf-8><meta content="Jeff’s note" name=apple-mobile-web-app-title><meta content="#0d6efd" name=theme-color><meta content="width=device-width,initial-scale=1" name=viewport><meta property="og:url" content="https://chienfuchen32.github.io/posts/"><meta property="og:site_name" content="Jeff's note"><meta property="og:title" content="Posts"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><title>Posts · Jeff’s note</title><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon-96x96.png rel=icon sizes=96x96 type=image/png><link href=/favicon.ico rel="shortcut icon"><link href=/favicon.svg rel=icon type=image/svg+xml><link href=/web-app-manifest-192x192.png rel=icon type=image/png><link href=/web-app-manifest-512x512.png rel=icon type=image/png><link href=/site.webmanifest rel=manifest><link crossorigin=anonymous href=/css/paige/paige.efdc55a0b6a76e01996afabae3de8e4b7dc3f7a0.min.3b5b583ef4a5c7e93743e15582585c9c2a7621b8fef6c9c7ad4bac50e4781f05.css integrity="sha256-O1tYPvSlx+k3Q+FVglhcnCp2Ibj+9snHrUusUOR4HwU=" referrerpolicy=no-referrer rel=stylesheet><link crossorigin=anonymous href=/css/paige/bootstrap/paige.37b3fc66686a7163af8180c5fb0fc6ab835321eb.min.55516fbe90a5aad46d6dbc2441c1c193504ee32cb1eef5070ab589c776231a4c.css integrity="sha256-VVFvvpClqtRtbbwkQcHBk1BO4yyx7vUHCrWJx3YjGkw=" referrerpolicy=no-referrer rel=stylesheet><link crossorigin=anonymous href=/css/paige/bootstrap-icons/bootstrap-icons.min.755bbaf60ab33d8f6213c74d33daea2ef5bf22d15245142a27529f8c1d7e80f1.css integrity="sha256-dVu69gqzPY9iE8dNM9rqLvW/ItFSRRQqJ1KfjB1+gPE=" referrerpolicy=no-referrer rel=stylesheet><link href=/posts/rss.xml rel=alternate type=application/rss+xml></head><body><div class=container><div class=row><div class="col mt-3" id=paige-site><header id=paige-site-header><div class="display-1 fw-bold text-center" id=paige-site-title><a class="text-body text-decoration-none" href=/>Jeff&rsquo;s note</a></div><nav aria-label=Menu class=paige-row-tall id=paige-site-menu><ul class="align-items-center justify-content-center nav"><li class=nav-item><a class="nav-link text-decoration-underline" href=/about/>About</a></li><li class=nav-item><a aria-current=page class="active fw-bold text-body nav-link text-decoration-underline" href=/posts/>Posts</a></li><li class=nav-item><a class="nav-link text-decoration-underline" href=/tags/>Tags</a></li></ul></nav><nav aria-label=Breadcrumbs class=paige-row-tall id=paige-site-breadcrumbs><div class="d-flex justify-content-center"><ol class="breadcrumb mb-0"><li class=breadcrumb-item><a href=/>Home</a></li></ol></div></nav></header><article class="align-items-center d-flex flex-column paige-kind-section paige-status-published" id=paige-page><header class="mw-100 text-center" id=paige-page-header><h1 class=fw-bold id=paige-page-title>Posts</h1></header></article><div id=paige-page-pages><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/infrastructure-as-code/>Terraform, Infrastructure as Code management tool</a></p><p class="fst-italic paige-page-summary paige-row-short">IaC Concept fast deployment for business requirement infrastructure consistency security compliance automation Azure cloud infra architecture overview https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks-microservices/aks-microservices Proposed GitOps flow change request stakeholder notification, plan IaC modularization for reusable purpose version control, branch: main, dev, new_net, new_db, stg, prd, … automating testing continuous deployment update process to related notificatition channel HCL Code example variable "aks_node_pool" { description = "" type = map(object({ vm_size = string node_count = number zones = list(string) os_disk_size_gb = number os_disk_type = string })) default = { "mqpool" : { vm_size = "Standard_DS4_v2", node_count = 6, zones = ["1", "2"], os_disk_size_gb = 64, os_disk_type = "Ephemeral" } "tbcorepool" : { vm_size = "Standard_DS3_v2", node_count = 3, zones = ["1", "2"], os_disk_size_gb = 64, os_disk_type = "Ephemeral" } "tbrepool" : { vm_size = "Standard_DS3_v2", node_count = 25, zones = ["1", "2"], os_disk_size_gb = 64, os_disk_type = "Ephemeral" } "tbtranspool" : { vm_size = "Standard_DS3_v2", node_count = 12, zones = ["1", "2"], os_disk_size_gb = 64, os_disk_type = "Ephemeral" } "tbjspool" : { vm_size = "Standard_DS2_v2", node_count = 6, zones = ["1", "2"], os_disk_size_gb = 64, os_disk_type = "Ephemeral" } } } module "aks" { source = "../../modules/azure/kubernetes" resource_group = var.resource_group location = var.location vnet_app_name = local.vnet_app_name subnet_aks_name = var.subnet_aks_name aks_name = local.aks_name aks_namespace_admin_group_object_ids = var.aks_namespace_admin_group_object_ids aks_admin_group_object_ids = var.aks_admin_group_object_ids apg_id = module.apg.apg_id acr_id = module.acr.acr_id aks_tags = var.aks_tags aks_default_node_pool = var.aks_default_node_pool aks_node_pool = var.aks_node_pool vnet_depends_on = [ module.network.vnet_app_name, module.apg.apg_id, module.acr.acr_id ] } for more detail, please check: https://github.com/chienfuchen32/terraform-azure Further IaC with documentation tool for more detail, please check: Cloud Native Taiwan User Group meetup #65 slide Ref https://www.redhat.com/en/topics/automation/what-is-infrastructure-as-code-iac https://about.gitlab.com/topics/gitops/ https://developer.hashicorp.com/terraform/language/modules https://developer.hashicorp.com/terraform/language/tests https://learn.microsoft.com/en-us/azure/devops/service-hooks/services/teams?view=azure-devops</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/continuous-deployment/>Continuous Deployment</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/continuous-integration/>Continuous Integration</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/devops/>DevOps</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/iac/>IaC</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/sre/>SRE</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2025-07-26>July 26, 2025</time></p><p class="paige-page-word-count paige-row-short text-secondary">264 words</p><p class="paige-page-reading-time paige-row-short text-secondary">2 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/thingsboard-performance-test/>Thingsboard Performance Test</a></p><p class="fst-italic paige-page-summary paige-row-short">Thingsboard Micro service Architecture version v3.5.1 Cloud Infrastructure Environment Azure Kubernetes v1.26.3. Tier: Standard
Load Balancer. sku: Standard
Azure Application Gateway. Tier: WAF V2 (auto scale instance 1-3)
Azure PostgreSQL Flexible Server. version: 14.8 sku: 1 * D2ds_v4, 2vCores, 8GiB RAM, 128GiB 500 IOPS Disk)
Azure Cache for Redis. sku: 1 * Premium P1 (6GB Cache Size)
Azure Managed Cassandra. version: 4 sku: 9 * D8s_V5 (8 vCPUs, 32GB RAM, 2 * P30 1024GiB, 5000 IOPS, 200 MB/sec Disk)</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/distributed-system/>Distributed System</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/high-availability/>High Availability</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/iot/>IoT</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/kubernetes/>Kubernetes</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/performance-test/>Performance Test</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/thingsboard/>Thingsboard</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2023-10-05>October 5, 2023</time></p><p class="paige-page-word-count paige-row-short text-secondary">8413 words</p><p class="paige-page-reading-time paige-row-short text-secondary">40 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/n-queen-problem/>N Queen Problem</a></p><p class="fst-italic paige-page-summary paige-row-short">Purpose TODO
Example from LeetCode 51. N-Queens problem link Implementation Backtracking all possible placement, check if it is queen attack range.
class Solution: def solveNQueens(self, n: int) -> List[List[str]]: place = [-1 for _ in range(n)] row = 0 place[0] = 0 ans = [] while True: if self.is_valid(place, n) is True: if row == n - 1: ans.append([''.join(b for b in self.board[i]) for i in range(n)]) else: row += 1 for j in range(row, -1, -1): if place[j] == n - 1: place[j] = -1 row -= 1 else: place[j] += 1 break if j == 0 and place[j] == -1: return ans else: place[row] += 1 def is_valid(self, place, n)->bool: self.board = [['.' for _ in range(n)] for _ in range(n)] for i in range(n): if place[i] != -1: self.board[i][place[i]] = 'Q' # row and col for i in range(n): for j in range(i+1, n): if place[j] != -1 and place[i] == place[j]: return False # cross for i in range(n): if place[i] == -1: continue for j in range(n): if j == 0: continue o = i + j p = place[i] + j if o >= 0 and o &lt; n and \ p >= 0 and p &lt; n: if self.board[o][p] == 'Q': return False o = i + j p = place[i] - j if o >= 0 and o &lt; n and \ p >= 0 and p &lt; n: if self.board[o][p] == 'Q': return False o = i - j p = place[i] + j if o >= 0 and o &lt; n and \ p >= 0 and p &lt; n: if self.board[o][p] == 'Q': return False o = i - j p = place[i] - j if o >= 0 and o &lt; n and \ p >= 0 and p &lt; n: if self.board[o][p] == 'Q': return False return True</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/algorithm/>Algorithm</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/backtracking/>Backtracking</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/data-structure/>Data Structure</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2023-06-14>June 14, 2023</time></p><p class="paige-page-word-count paige-row-short text-secondary">311 words</p><p class="paige-page-reading-time paige-row-short text-secondary">2 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/least-recently-used-cache/>Least Recently Used Cache</a></p><p class="fst-italic paige-page-summary paige-row-short">Purpose TODO
Example from LeetCode 146. LRU Cache problem link Implementation TODO commemt
class Node: def __init__(self, key, value, prev=None, nxt=None): self.key = key self.value = value self.prev = prev self.next = nxt class DoubleLinkList: def __init__(self): self.head = None self.tail = None self.length = 0 def add_node_to_tail(self, node: Node) -> None: self.length += 1 if self.head is None: self.head = node return if self.tail is None: self.tail = node self.tail.prev = self.head self.head.next = self.tail return self.tail.next = node node.prev = self.tail self.tail = node def remove_node_from_head(self) -> int: self.length -= 1 old_key = self.head.key self.head = self.head.next if self.head is not None: self.head.prev = None return old_key def remove_node_from_node(self, node) -> None: self.length -= 1 if node.prev is not None: node.prev.next = node.next if node.next is not None: node.next.prev = node.prev if node == self.tail: if self.tail.prev is not None: self.tail.prev.next = None self.tail = self.tail.prev if node == self.head: if self.head.next is not None: self.head.next.prev = None self.head = self.head.next def print_all_node(self) -> None: ptr = self.head while ptr is not None: ptr = ptr.next class LRUCache: def __init__(self, capacity: int): self.cache = {} # {key: Node} self.link_list = DoubleLinkList() self.capacity = capacity def get(self, key: int) -> int: if self.cache.get(key, None) is not None: node = self.cache[key] value = node.value new_node = Node(key, value) self.link_list.remove_node_from_node(node) self.cache[key] = new_node self.link_list.add_node_to_tail(new_node) return value return -1 def put(self, key: int, value: int) -> None: if self.cache.get(key, None) is not None: node = self.cache[key] del self.cache[key] self.link_list.remove_node_from_node(node) else: if self.link_list.length >= self.capacity: head_key = self.link_list.remove_node_from_head() del self.cache[head_key] new_node = Node(key, value) self.cache[key] = new_node self.link_list.add_node_to_tail(new_node)</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/algorithm/>Algorithm</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/data-structure/>Data Structure</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2023-05-31>May 31, 2023</time></p><p class="paige-page-word-count paige-row-short text-secondary">265 words</p><p class="paige-page-reading-time paige-row-short text-secondary">2 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/how-to-repair-file-system-provided-from-kubernetes-ceph-persistent-volume/>How to Repair File System Provided From Kubernetes Ceph Persistent Volume</a></p><p class="fst-italic paige-page-summary paige-row-short">How to repair file system provided from Kubernetes ceph persistent volume 某日由於底層VM出現硬體故障，整座自建的Kubernetes接受影響， 部署於該環境的應用MySQL無法掛載pv，從pod出現的錯誤訊息如下:
MountVolume.SetUp failed for volume "pvc-78cf22fa-d776-43a4-98d7-d594f02ea018" : mount command failed, status: Failure, reason: failed to mount volume /dev/rbd13 [xfs] to /var/lib/kubelet/plugins/ceph.rook.io/rook-ceph/mounts/pvc-78cf22fa-d776-43a4-98d7-d594f02ea018, error mount failed: exit status 32 Mounting command: systemd-run Mounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/plugins/ceph.rook.io/rook-ceph/mounts/pvc-78cf22fa-d776-43a4-98d7-d594f02ea018 --scope -- mount -t xfs -o rw,defaults /dev/rbd13 /var/lib/kubelet/plugins/ceph.rook.io/rook-ceph/mounts/pvc-78cf22fa-d776-43a4-98d7-d594f02ea018 Output: Running scope as unit run-r2594d6c82152421c8891bfa8761e8c05.scope. mount: mount /dev/rbd13 on /var/lib/kubelet/plugins/ceph.rook.io/rook-ceph/mounts/pvc-78cf22fa-d776-43a4-98d7-d594f02ea018 failed: Structure needs cleaning 處理方式: 透過ceph tool重新掛載該pv的image，試著使用fsck修復</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/csi/>CSI</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/ingress/>Ingress</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/kubernetes/>Kubernetes</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2023-05-06>May 6, 2023</time></p><p class="paige-page-word-count paige-row-short text-secondary">937 words</p><p class="paige-page-reading-time paige-row-short text-secondary">5 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/continuous-integration-continuous-deployment/>Continuous Integration Continuous Deployment</a></p><p class="fst-italic paige-page-summary paige-row-short">DevOps concept & practice |---------| |---------| merge |-------| |--------------------------| |local dev|------->| version |-------->| build |--------->|* security check | |---------| commit | control | trigger | agent | pipeline |* build / push artifact | ^ |---------| webhook |-------| task |* unit / integration test | | |--------------------------| | | |---------------------| analysis |------------| operation |----------------| |release | * next release plan |&lt;---------| monitor |---------->| staging |&lt;--| | * issues action | | metrics log| | production env | |---------------------| |------------| |----------------|</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/continuous-deployment/>Continuous Deployment</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/continuous-integration/>Continuous Integration</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/devops/>DevOps</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2022-09-15>September 15, 2022</time></p><p class="paige-page-word-count paige-row-short text-secondary">80 words</p><p class="paige-page-reading-time paige-row-short text-secondary">1 minute</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/nginx-ingress-controller-k8s-guide/>Nginx Ingress Controller K8S Guide</a></p><p class="fst-italic paige-page-summary paige-row-short">Nginx 介紹 Nginx是非同步框架的網頁伺服器，也可以用作反向代理、負載平衡器和HTTP快取。 設置範例 server { listen 80; listen [::]:80; server_name localhost; listen 443 ssl default_server; ssl_certificate /tls/server.crt; ssl_certificate_key /tls/server.key; #charset koi8-r; #access_log /var/log/nginx/host.access.log main; location / { #root /usr/share/nginx/html; #index index.html index.htm; proxy_pass http://192.168.24.100:9090/; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &amp;#34;Upgrade&amp;#34;; proxy_set_header Host $host; proxy_connect_timeout 60s; proxy_read_timeout 300s; proxy_send_timeout 300s; } location /socket.io { proxy_pass http://192.168.24.100:9091/; #Version 1.1 is recommended for use with keepalive connections proxy_http_version 1.1; #WebSocket proxy_set_header Upgrade $http_upgrade; #WebSocket proxy_set_header Connection $connection_upgrade; #WebSocket proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto https; proxy_set_header Cookie $http_cookie; } error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } 可以透過nginx -s reload讓nginx對新的配置生效</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/ingress/>Ingress</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/kubernetes/>Kubernetes</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/reverse-proxy/>Reverse Proxy</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2022-04-15>April 15, 2022</time></p><p class="paige-page-word-count paige-row-short text-secondary">546 words</p><p class="paige-page-reading-time paige-row-short text-secondary">3 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/k8s-guide-for-developer/>Kubernetes Guide for Developer</a></p><p class="fst-italic paige-page-summary paige-row-short">Environment Before you try to use any client tool connect to Kubernetes, please check the endpoint field “server” of “cluster” credential config file.
Please make sure you’re able connect with the kube-apiserver.
For instance, example below shown here is “k8s-cluster”
apiVersion: v1 kind: Config clusters: - name: team-a-admin@kubernetes cluster: server: 'https://k8s-cluster:8443' certificate-authority-data: >- xxxxx users: - name: team-a-admin user: token: >- xxxxx contexts: - name: team-a-admin@kubernetes context: user: team-a-admin cluster: team-a-admin@kubernetes namespace: team-a current-context: team-a-admin@kubernetes This example is based on self-host Kubernetes v1.18 environment, you machine might not be able to recognize the target,</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/ingress/>Ingress</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/kubernetes/>Kubernetes</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2022-03-18>March 18, 2022</time></p><p class="paige-page-word-count paige-row-short text-secondary">497 words</p><p class="paige-page-reading-time paige-row-short text-secondary">3 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/luks-tang/>Disk encryption: LUKS ( Linux Unified Key Setup) with Tang</a></p><p class="fst-italic paige-page-summary paige-row-short">Key component tang server is responsible for helping dracut to decrypt the target disk. It won’t store any client key. encrypted server is required to use clevis, dracut. It provide a easier way that integrate with tang server to decrypt LUKS disk. Network topology |-------------------------| |------------| |LUKS encrypted server |-- disk decryption -->|tang server | |(clevis, dracut) [env] |&lt;----- response ------|[tang] | |-------------------------| |____________| Tang server software installation via apt on x86x64 Ubuntu 20.04 adm@tang:~$ sudo apt-get install tang -y ## check version adm@tang:~$ apt list --installed | grep tang tang/focal,now 7-1build1 amd64 [installed] ## Enable the tangd service adm@tang:~$ sudo systemctl enable tangd.socket Create an override file with 7500 to prevent port conflict adm@tang:~$ sudo systemctl edit tangd.socket # tangd.socket [Socket] ListenStream= ListenStream=7500 adm@tang:~$ sudo systemctl daemon-reload ## Check that your configuration is working: adm@tang:~$ sudo systemctl show tangd.socket -p Listen Listen=[::]:7500 (Stream) ## Start the tangd service adm@tang:~$ sudo systemctl restart tangd.socket adm@tang:~$ sudo systemctl status tangd.socket ● tangd.socket - Tang Server socket Loaded: loaded (/lib/systemd/system/tangd.socket; enabled; vendor preset: enabled) Drop-In: /etc/systemd/system/tangd.socket.d └─override.conf Active: active (listening) since Mon 2022-03-14 00:54:03 UTC; 1h 25min ago Triggers: ● tangd@0.service Listen: [::]:7500 (Stream) Accepted: 0; Connected: 0; Tasks: 0 (limit: 984) Memory: 44.0K CGroup: /system.slice/tangd.socket Mar 14 00:54:03 d systemd[1]: Listening on Tang Server socket. encrypted server: try clevis, luks to bind with tang Assume that tang server is now running on 192.168.100.10:7500, we need to run clevis to bind local encrypted disk (/dev/md0 in this case) with tang.</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/encryption/>Encryption</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/linux-unified-key-setup/>Linux Unified Key Setup</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2022-03-17>March 17, 2022</time></p><p class="paige-page-word-count paige-row-short text-secondary">1782 words</p><p class="paige-page-reading-time paige-row-short text-secondary">9 minutes</p></div><div class="paige-page paige-status-draft paige-status-unpublished text-center w-100"><p class="paige-page-title paige-row-short"><a href=/posts/on-prem-k8s-installation/>On-Premises K8s Installation</a></p><p class="fst-italic paige-page-summary paige-row-short">Load balancer & VIP HAProxy & Keepalived Init HA control plane & worker node sudo kubeadm init --control-plane-endpoint "LOAD_BALANCER_DNS:LOAD_BALANCER_PORT" --upload-certs ... ... You can now join any number of control-plane node by running the following command on each as a root: kubeadm join 192.168.0.200:6443 --token 9vr73a.a8uxyaju799qwdjv --discovery-token-ca-cert-hash sha256:7c2e69131a36ae2a042a339b33381c6d0d43887e2de83720eff5359e26aec866 --control-plane --certificate-key f8902e114ef118304e561c3ecd4d0b543adc226b7a07f675f56564185ffe0c07 Please note that the certificate-key gives access to cluster sensitive data, keep it secret! As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use kubeadm init phase upload-certs to reload certs afterward. Then you can join any number of worker nodes by running the following on each as root: kubeadm join 192.168.0.200:6443 --token 9vr73a.a8uxyaju799qwdjv --discovery-token-ca-cert-hash sha256:7c2e69131a36ae2a042a339b33381c6d0d43887e2de83720eff5359e26aec866 Networking with Weave Net $ kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')" https://www.weave.works/docs/net/latest/overview/ https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/ Ingress controller with Nginx $ kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.1/deploy/static/provider/cloud/deploy.yaml https://kubernetes.github.io/ingress-nginx/ Storage Ceph $ git clone --single-branch --branch v1.10.1 https://github.com/rook/rook.git $ cd rook/deploy/examples $ kubectl create -f crds.yaml -f common.yaml -f operator.yaml $ kubectl create -f cluster.yaml https://rook.io/docs/rook/v1.10/Getting-Started/intro/ Monitoring Prometheus, Grafana $ helm repo add prometheus-community https://prometheus-community.github.io/helm-charts $ helm repo update $ helm install -n [NAMESPACE] [RELEASE_NAME] prometheus-community/kube-prometheus-stack https://prometheus.io https://grafana.com/oss/grafana/ Log Loki $ helm repo add grafana https://grafana.github.io/helm-charts $ helm repo update $ helm upgrade --install --namespace=[NAMESPACE] [RELEASE_NAME] grafana/loki-stack https://grafana.com/oss/loki/</p><p class="paige-page-keywords paige-row-short text-secondary"><a class="link-secondary paige-page-keyword-tag" href=/tags/cni/>CNI</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/csi/>CSI</a>
·
<a class="link-secondary paige-page-keyword-tag" href=/tags/kubernetes/>Kubernetes</a></p><p class="paige-page-date paige-row-short text-secondary"><time datetime=2020-09-18>September 18, 2020</time></p><p class="paige-page-word-count paige-row-short text-secondary">209 words</p><p class="paige-page-reading-time paige-row-short text-secondary">1 minute</p></div></div><footer id=paige-site-footer><p class="paige-row-short text-center text-secondary" id=paige-site-credit><a class="link-secondary text-decoration-none" href=https://github.com/willfaught/paige>Paige Theme</a></p></footer></div></div></div><script crossorigin=anonymous defer integrity="sha256-GdpV5fXTSprZ1he71RUKGZl0E3HtqxFXvbylEdkWmRQ=" referrerpolicy=no-referrer src=/js/paige/bootstrap/bootstrap.bundle.min.19da55e5f5d34a9ad9d617bbd5150a1999741371edab1157bdbca511d9169914.js></script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","dateCreated":"2025-07-26T22:38:40+08:00","dateModified":"2025-07-26T22:38:40+08:00","headline":"Posts","inLanguage":"en-us","name":"Posts","timeRequired":"PT0M","url":"https://chienfuchen32.github.io/posts/"}</script><noscript>JavaScript is required</noscript></body></html>